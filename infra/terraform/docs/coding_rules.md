# コーディング規約

Terraform コードのコーディング規約

コーディング規約の大部分は"[Terraform を使用するためのベスト プラクティス](https://cloud.google.com/docs/terraform/best-practices-for-terraform)"を基にしています。

基本的にはこのドキュメントが優先されますがこのドキュメントで抜けている部分は「Terraform を使用するためのベスト プラクティス」に従ってください。

## 再利用可能なモジュールに配置するファイル

| ファイル、ディレクトリ名 | required | 説明                                                                                                                                                                                                                                 |
| ------------------------ | -------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| README.md                | FALSE    | 入力や出力、作成するリソース、依存するモジュールを記載                                                                                                                                                                               |
| provider.tf              | TRUE     | provider ブロックの定義                                                                                                                                                                                                              |
| versions.tf              | TRUE     | プロバイダのバージョンの指定                                                                                                                                                                                                         |
| main.tf                  | FALSE    | リソースブロック、モジュールブロックのみを記述</br>おおよそ一画面に収まらない行数になったら(24 インチのディスプレイの vscode で約６０行なので５０行程度）全てのリソース、モジュールは専用のファイルに移動し、 main.tf ファイルは削除 |
| [service name].tf        | FALSE    | main.tf が大きくなった場合にリソースブロックをこちらのファイルに記述を移動</br>リソースタイプ名毎（iam user 等)にファイルを作るとファイル数が大きくなるのでサービスタイプ毎（Iam）にファイルを作成                                   |
| variables.tf             | FALSE    | モジュールへの入力、variables ブロックを記載                                                                                                                                                                                         |
| outputs.tf               | FALSE    | モジュール内で作成したリソースを外部からデータブロックで参照する値を記載                                                                                                                                                             |
| data.tf                  | FALSE    | データブロックを記述                                                                                                                                                                                                                 |
| docs/                    | FALSE    | README.md に書ききれないドキュメント                                                                                                                                                                                                 |

## ルートモジュールに配置するファイル

| ファイル、ディレクトリ名 | required | 説明                                                                                               |
| ------------------------ | -------- | -------------------------------------------------------------------------------------------------- |
| README.md                | FALSE    | 入力や出力、作成するリソース、依存するモジュールを記載                                             |
| provider.tf              | TRUE     | provider ブロックの定義                                                                            |
| versions.tf              | TRUE     | プロバイダのバージョンの指定                                                                       |
| main.tf                  | TRUE     | モジュールブロックのみを記述                                                                       |
| variables.tf             | FALSE    | 他のモジュールで作成したリソースをステートファイルから取得し、対象のモジュールに使用する場合に記載 |
| outputs.tf               | TRUE     | モジュール内で作成したリソースを外部からデータブロックで参照する値を記載                           |
| backends.tf              | TRUE     | Terraform のリモートバックエンドのステートファイルの場所を記述                                     |
| data.tf                  | FALSE    | データブロックを記述                                                                               |
| moved.tf                 | FALSE    | リソース名の変更やモジュールの移動                                                                 |
| docs/                    | FALSE    | README.md に書ききれないドキュメント                                                               |
| .terraform.lock.hcl      | TRUE     | ルートモジュールの場合必ずあるファイル、依存関係の管理、terraform コマンドの操作時に自動生成       |

## 既にステートファイルに適用済みのリソース名を変更する場合は moved ブロックを使用する

moved ブロックを使わない場合は`plan`や`apply`の結果が問題無いか確認するのにあらかじめステートファイルを変更する必要がある為、moved ブロックを使用してください。
